pico-8 cartridge // http://www.pico-8.com
version 22
__lua__
-- game loop

function _init()
  paddle_init(10, 24)
  ball_init(32, 48)
end

function _update()
  paddle_move()
  ball_move()
end

function _draw()
  cls()
  map(0,0,0,0)

  paddle_draw()
  ball_draw()
end

-->8
-- paddle functions
function paddle_init(x, y)
  p={}
  p.spr=1
  p.x=x
  p.y=y
  p.w=2  -- width in pixels
  p.h=16 -- height in pixels
end

function paddle_move()
  local spd = 5
  local next_y = p.y

  if btnp(⬆️) then
    next_y = p.y - spd

    if is_ceil(p.x, next_y) then
      sfx(0)
      next_y = (row(next_y) * 8) + 8
    end
  end

  if btnp(⬇️) then
    next_y = p.y + spd

    if is_ceil(p.x, next_y + p.h) then
      sfx(0)
      next_y = (row(next_y + p.h) * 8) - p.h
    end
  end

  -- if btnp(⬇️) then next_y = p.y + 4 end
  -- if btnp(⬆️) then next_y = p.y - 4 end

  -- if is_ceil(p.x, next_y) then
  --   sfx(0)
  --   p.y = row(next_y) * 8
  -- elseif is_ceil(p.x, next_y + p.h) then
  --   sfx(0)
  --   p.y = row(next_y + p.h) * 8
  -- else
    p.y = next_y
  -- end
end

function paddle_draw()
  spr(p.spr, p.x, p.y, p.w/8, p.h/8)
end

-->8
-- ball functions

function ball_init(x, y)
  b={}
  b.spr=2
  b.x=x
  b.y=y
  b.w=2 -- width in pixels
  b.h=2 -- height in pixels
  b.xd=1
  b.yd=-1
end

function ball_move()
  local next_x = b.x + b.xd
  local next_y = b.y + b.yd

  if is_ceil(next_x, next_y) then
    sfx(0)
    b.yd *= -1
  end 
  
  if is_wall(next_x, next_y) then
    sfx(0)
    b.xd *= -1
  end

  if is_paddle(next_x, next_y) then
    sfx(0)
    b.xd *= -1
  end

  b.x += b.xd
  b.y += b.yd
end

function ball_draw()
  spr(b.spr, b.x, b.y, b.w/8, b.h/8)
end

-->8
-- util functions

function col(x)
  return flr(x/8)
end

function row(y)
  return flr(y/8)
end

function tile_at(x,y)
  return mget(col(x), row(y))
end

function is_ceil(x,y)
  tile = tile_at(x,y)
  return fget(tile, 0) and fget(tile,1)
end

function is_wall(x,y)
  tile = tile_at(x,y)
  return fget(tile, 0) and fget(tile,2)
end

function is_paddle(x, y)
  return x < p.x + p.w and y > p.y and y < p.y + p.h
end

__gfx__
00000000770000007700000077777777000000007000000000000007000000000000000070000000000000070000000000000000000000000000000000000000
00000000770000007700000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00700700770000000000000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00077000770000000000000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00077000770000000000000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00700700770000000000000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000007000000000000007000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000777777777000000000000007700000000000000700000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0005000303050507070707010100000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0804040404040404040404040404040700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a03030303030303030303030303030900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0603030303030303030303030303030500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0604040404040404040404040404040500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200000b0501a050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
